{"version":3,"file":"core_image/index.js","mappings":"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","sources":["webpack://ds-citeocom/external window [\"wp\",\"blockEditor\"]","webpack://ds-citeocom/external window [\"wp\",\"components\"]","webpack://ds-citeocom/external window [\"wp\",\"compose\"]","webpack://ds-citeocom/external window [\"wp\",\"hooks\"]","webpack://ds-citeocom/external window \"React\"","webpack://ds-citeocom/external window \"ReactJSXRuntime\"","webpack://ds-citeocom/webpack/bootstrap","webpack://ds-citeocom/webpack/runtime/compat get default export","webpack://ds-citeocom/webpack/runtime/define property getters","webpack://ds-citeocom/webpack/runtime/hasOwnProperty shorthand","webpack://ds-citeocom/webpack/runtime/make namespace object","webpack://ds-citeocom/./src/core_image/index.js"],"sourcesContent":["module.exports = window[\"wp\"][\"blockEditor\"];","module.exports = window[\"wp\"][\"components\"];","module.exports = window[\"wp\"][\"compose\"];","module.exports = window[\"wp\"][\"hooks\"];","module.exports = window[\"React\"];","module.exports = window[\"ReactJSXRuntime\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { addFilter } from \"@wordpress/hooks\";\r\nimport { createHigherOrderComponent } from \"@wordpress/compose\";\r\nimport { InspectorControls, MediaUpload } from \"@wordpress/block-editor\";\r\nimport { PanelBody, PanelRow, TextareaControl, FocalPointPicker, __experimentalToggleGroupControl as ToggleGroupControl, __experimentalToggleGroupControlOption as ToggleGroupControlOption, } from \"@wordpress/components\";\r\nimport { useState, useEffect } from 'react';\r\n\r\nconst allowedBlocks = ['core/image'];\r\n\r\nfunction addAttributes(settings, name) {\r\n    if (!allowedBlocks.includes(name) || !settings.attributes) {\r\n        return settings;\r\n    }\r\n\r\n    settings.attributes.mobileSrc = {\r\n        type: \"string\",\r\n        default: \"\"\r\n    };\r\n\r\n    settings.attributes.customCaption = {\r\n        type: \"string\",\r\n        default: \"\"\r\n    };\r\n\r\n    settings.attributes.focalPoint = {\r\n        type: \"object\",\r\n        default: { x: 0.5, y: 0.5 }\r\n    };\r\n\r\n    settings.attributes.objectFitType = {\r\n        type: \"string\",\r\n        default: \"cover\"\r\n    };\r\n\r\n    return settings;\r\n}\r\n\r\n\r\nconst addAdvancedControls = createHigherOrderComponent((Block) => {\r\n    return (props) => {\r\n\r\n        const { name, attributes, setAttributes } = props;\r\n        const { mobileSrc, customCaption, focalPoint, objectFitType, url } = attributes;\r\n        const [localFocalPoint, setLocalFocalPoint] = useState(focalPoint || { x: 0.5, y: 0.5 });\r\n\r\n        // Effet unique pour appliquer les styles en temps réel\r\n        useEffect(() => {\r\n           \r\n            \r\n            const timer = setTimeout(() => {\r\n                // Chercher l'image dans l'éditeur (iframe ou document principal)\r\n                let img = null;\r\n                \r\n                const iframe = document.querySelector('iframe[name=\"editor-canvas\"]');\r\n                if (iframe && iframe.contentDocument) {\r\n                    const blockElement = iframe.contentDocument.querySelector(`[data-block=\"${props.clientId}\"]`);\r\n                    if (blockElement) {\r\n                        img = blockElement.querySelector('div img') || blockElement.querySelector('img');\r\n                    }\r\n                }\r\n                \r\n                // Fallback sur le document principal\r\n                if (!img) {\r\n                    const blockElement = document.querySelector(`figure[data-block=\"${props.clientId}\"]`);\r\n                    if (blockElement) {\r\n                        img = blockElement.querySelector('div img') || blockElement.querySelector('img');\r\n                    }\r\n                }\r\n                \r\n                // Appliquer les styles selon l'état\r\n                if (img) {\r\n                    \r\n                    if (objectFitType === \"cover\" && localFocalPoint) {\r\n                        img.style.objectFit = 'cover';\r\n                        img.style.objectPosition = `${localFocalPoint.x * 100}% ${localFocalPoint.y * 100}%`;\r\n                    } else {\r\n                        img.style.objectFit = 'contain';\r\n                        img.style.objectPosition = '';\r\n                    }\r\n                } \r\n            }, 100);\r\n            \r\n            return () => clearTimeout(timer);\r\n        }, [objectFitType, localFocalPoint, url]); \r\n\r\n        // Si ce n'est pas le bon bloc, on quitte et on retourne le bloc original, inchangé\r\n        if (!allowedBlocks.includes(name)) {\r\n            return (\r\n                <Block {...props} />\r\n            )\r\n        }\r\n\r\n        // Ajout de l'élément dans l'inspecteur\r\n        return (\r\n            <>\r\n                <Block {...props} />\r\n                \r\n                <InspectorControls>\r\n                    <PanelBody \r\n                        title={\"Gestion de l'image mobile\"}\r\n                        initialOpen={ true }\r\n                    >\r\n                        <PanelRow>\r\n                            <MediaUpload\r\n                                onSelect={(media) => {\r\n                                    setAttributes({\tmobileSrc: media.url });\r\n                                }}\r\n                                multiple={false}\r\n                                title={'Téléversez votre image'}\r\n                                render={({ open }) => (\r\n                                    <>\r\n                                        <button \r\n                                            onClick={open} \r\n                                            aria-label={'Uploadez votre fichier'}\r\n                                            style={{\r\n                                                padding: '.75rem 2rem',\r\n                                                display: 'flex',\r\n                                                justifyContent: 'center',\r\n                                                alignItems: 'center',\r\n                                                cursor: 'pointer',\r\n                                                borderRadius: '.5rem',\r\n                                                background: 'var(--wp-components-color-accent,var(--wp-admin-theme-color,#3858e9))',\r\n                                                color: '#fff',\r\n                                            }}\r\n                                        >Téléverser l'image</button>\r\n                                    </>\r\n                                )}\r\n                            />\r\n                        </PanelRow>\r\n\r\n                        {mobileSrc.length > 0 && \r\n                            <>\r\n                                <PanelRow>\r\n                                    Image mobile actuelle :\r\n                                </PanelRow>\r\n\r\n                                <PanelRow>\r\n                                    <img \r\n                                        src={mobileSrc} \r\n                                        style={{\r\n                                            width: '100%',\r\n                                            maxHeight: '10rem',\r\n                                            objectFit: 'contain',\r\n                                            objectPosition: 'left center'\r\n                                        }}\r\n                                    />\r\n                                </PanelRow>\r\n                            </>\r\n                        }\r\n                        \r\n                    </PanelBody>\r\n\r\n                    <PanelBody \r\n                        title={\"Caption personnalisé\"}\r\n                        initialOpen={ false }\r\n                    >\r\n                        <PanelRow>\r\n                            <TextareaControl\r\n                                label=\"Légende accessible via lecteur d'écran\"\r\n                                value={customCaption}\r\n                                onChange={(value) => setAttributes({ customCaption: value })}\r\n                                placeholder=\"Entrez une description accessible de l'image...\"\r\n                            />\r\n                        </PanelRow>\r\n                    </PanelBody>\r\n\r\n\r\n                    <PanelBody title={'Paramètre d\\'image'} initialOpen={true}>\r\n                        <ToggleGroupControl\r\n                            label=\"Affichage de l'image\"\r\n                            value={objectFitType}\r\n                            onChange={(value) => setAttributes({ objectFitType: value })}\r\n                            style={{width: '100%'}}\r\n                        >\r\n                            <ToggleGroupControlOption \r\n                                value=\"contain\"\r\n                                label=\"Entière\" \r\n                                aria-label = {'L\\'image non croppée occupe tout l\\'espace disponible.'}\r\n                                showTooltip = { true }\r\n                            />\r\n                            <ToggleGroupControlOption \r\n                                value=\"cover\"\r\n                                label=\"Point de focal\" \r\n                                aria-label = {'Image avec point de focalisation défini.'}\r\n                                showTooltip = { true }\r\n                            />\r\n\t\t\t\t\t    </ToggleGroupControl>\t\r\n\r\n                    {objectFitType === \"cover\" && attributes.url && (\r\n                            <PanelRow>\r\n                                <FocalPointPicker\r\n                                    __nextHasNoMarginBottom\r\n                                    url={attributes.url}\r\n                                    value={localFocalPoint}\r\n                                    onDragStart={setLocalFocalPoint}\r\n                                    onDrag={setLocalFocalPoint}\r\n                                    onChange={(value) => {\r\n                                        setLocalFocalPoint(value);\r\n                                        setAttributes({ focalPoint: value });\r\n                                    }}\r\n                                />\r\n                            </PanelRow>\r\n                    )}\t\t\r\n\t\t\t\t</PanelBody> \r\n\r\n                </InspectorControls>\r\n            </>\r\n        );\r\n    };\r\n}, 'addAdvancedControls');\r\n\r\n// Ajout d’un nouvel attribut dans le bloc\r\naddFilter(\r\n    'blocks.registerBlockType',\r\n    'ds-citeocom/image-custom-attributes',\r\n    addAttributes\r\n);\r\n// Ajout des champs dans l’inspecteur du bloc\r\naddFilter(\r\n    'editor.BlockEdit',\r\n    'ds-citeocom/image-custom-advanced-control',\r\n    addAdvancedControls\r\n);"],"names":["addFilter","createHigherOrderComponent","InspectorControls","MediaUpload","PanelBody","PanelRow","TextareaControl","FocalPointPicker","__experimentalToggleGroupControl","ToggleGroupControl","__experimentalToggleGroupControlOption","ToggleGroupControlOption","useState","useEffect","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","allowedBlocks","addAttributes","settings","name","includes","attributes","mobileSrc","type","default","customCaption","focalPoint","x","y","objectFitType","addAdvancedControls","Block","props","setAttributes","url","localFocalPoint","setLocalFocalPoint","timer","setTimeout","img","iframe","document","querySelector","contentDocument","blockElement","clientId","style","objectFit","objectPosition","clearTimeout","children","title","initialOpen","onSelect","media","multiple","render","open","onClick","padding","display","justifyContent","alignItems","cursor","borderRadius","background","color","length","src","width","maxHeight","label","value","onChange","placeholder","showTooltip","__nextHasNoMarginBottom","onDragStart","onDrag"],"sourceRoot":""}